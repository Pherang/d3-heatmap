<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="./d3.js"></script>
    
    <style>

    .chart {
      font-family: sans-serif;
    }

    .chart-container {
      width: 1480px;
      height: 460px;
      margin: auto;
    }

    .y-axis {
    }

    #tooltip {
      pointer-events: none;

    }

    </style>

  </head>

  <body>
    
    <div class="chart-container">
      <svg class="chart"></svg>
    </div>


  <script>

    let tooltip = d3.select("body")
                    .append("div")
                      .attr("id", "tooltip")
                      .attr("display", "none")

    const margin = { left: 60, top: 30, right: 30, bottom: 40 },
        width = 1480 - margin.left - margin.right,
        height = 480 - margin.top - margin.bottom

    const xScale = d3.scaleBand() 
                     .range([0, width])

    const yScale = d3.scaleBand()
                     .range([height,0])

    const cScale = d3.scaleQuantile()
                     .range(["darkblue","blue","lightblue", "beige","pink", "orangered","darkred"])

    const xAxis = d3.axisBottom(xScale)  

    const yAxis = d3.axisLeft(yScale)

    let chart = d3.select(".chart")
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                    .attr("class", "graph")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")" )

    //d3.json("https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/global-temperature.json")
    d3.json("./global-temperature.json")
      .then( function(jsonData) {
      // Process data
      console.log(jsonData)
      return jsonData
    }).then( function(jsonData){
      // Draw data

      let months = ["none", "January", "February", "March","April","May","June","July","August","September","October","November","December"]

      let xDomain = []
      let yDomain = []
      let cDomain = []

      for (let i = 1753; i < 2016; i++)
        xDomain.push(i)

      for (let i = 12; i > 0; i--)
        yDomain.push(i)

      for (let i = 0; i < jsonData.monthlyVariance.length; i++)
        cDomain.push(jsonData.monthlyVariance[i].variance)

      xScale.domain(xDomain)
      yScale.domain(yDomain)
      cScale.domain(d3.extent(cDomain))

      console.log(d3.extent(cDomain))

      xAxis.tickValues(xScale.domain().filter(function(d,i) { return !(d % 10); }))
      yAxis.tickFormat(function(d) { return months[d]})

      chart.append("g")
        .attr("class", "x-axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)

      chart.append("g")
        .attr("class", "y-axis")
        .call(yAxis)

      chart.selectAll(".cell")
        .data(jsonData.monthlyVariance)
        .enter().append("rect")
          .attr("x", (d) => xScale(d.year))
          .attr("y", (d) => yScale(d.month))
          .attr("fill", (d) => ( cScale(d.variance)))
          .attr("stroke", "black")
          .attr("stroke-width", 0.25)
          .attr("width", xScale.bandwidth())
          .attr("height", yScale.bandwidth())
          
            
    }).catch( function(error) {
        console.log("Graphing error: ", error.message)
    })

    console.log("End")


  </script>

  </body>
</html>
